<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

<h:body>
	<ui:composition template="/template/layout.xhtml">
		<ui:define name="title">Etat des stocks</ui:define>

		<ui:define name="menu">
			<ui:include src="/template/storeKeeperMenu.xhtml" />
		</ui:define>

		<ui:define name="content">
			<f:view>
				<h:form>
					<p:commandButton value="Ajouter un produit"
						actionListener="#{skProducts.addNewProduct()}"
						onclick="PF('dlg1').show();" update=":updateDialog:updatePanel" />
				</h:form>

				<p:accordionPanel value="#{skProducts.getAllCategories()}" var="cat">
					<p:tab title="#{cat.toString()}">
						<p:accordionPanel id="subAccordion" dynamic="true" cache="true"
							value="#{skProducts.getSubCategories(cat)}" var="subCat">
							<p:tab title="#{subCat.name}">
								<h:form id="form">
									<p:dataGrid value="#{skProducts.getStoreProducts(subCat)}"
										var="product" columns="4" layout="grid" rows="8"
										paginator="true" id="items"
										paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
										rowsPerPageTemplate="6,12">
										<p:panel style="text-align:center">
											<h:panelGrid columns="1" style="text-align:center;width:100%">
												<p:graphicImage library="image" name="product-icon.png" />
												<h:outputText value="#{product.designation}" />
												<h:outputText value="Ref : #{product.productId}" />
												<h:outputText
													value="Quantité :  #{skProducts.getQuantity(product)}" />
												<p:selectBooleanButton id="box"
													value="#{product.visibility}" onLabel="Disponible"
													offLabel="Indisponible" onIcon="ui-icon-check"
													offIcon="ui-icon-close" style="width:140px">
													<p:ajax listener="#{skProducts.updateVisibility(product)}" />
												</p:selectBooleanButton>
												<p:commandButton value="Modifier"
													actionListener="#{skProducts.setCurrentProduct(product)}"
													onclick="PF('dlg1').show();"
													update=":updateDialog:updatePanel" />
											</h:panelGrid>
										</p:panel>
									</p:dataGrid>
								</h:form>
							</p:tab>
						</p:accordionPanel>
					</p:tab>
				</p:accordionPanel>

				<h:form id="updateDialog" prependId="true"
					enctype="multipart/form-data">
					<p:dialog header="Modifier produit" widgetVar="dlg1" modal="false"
						height="630" width="700">
						<p:outputPanel id="updatePanel">

							<div class="form-group" style="width: 100%">
								<label for="categorie">Catégorie :</label><br />
								<p:selectOneMenu id="sub" value="#{skProducts.subCategory.name}"
									style="width: 100% !important;">
									<f:selectItem
										itemLabel="#{skProducts.currentProduct.subCategory.name}"
										itemValue="#{skProducts.currentProduct.subCategory.name}" />
									<f:selectItems value="#{skProducts.getAllSubCategories()}"
										var="c" itemLabel="#{c.name}" itemValue="#{c.name}" />
								</p:selectOneMenu>
							</div>
							<table class="table">
								<tr>
									<td style="width: 70%">
										<div class="form-group">
											<label for="Designation">Désignation :</label>
											<h:inputText type="text" class="form-control" id="des"
												value="#{skProducts.currentProduct.designation}" />
										</div>
										<div class="form-group">
											<label for="Conditionnnement">Conditionnement :</label>
											<h:inputText type="text" class="form-control"
												name="Conditionnement"
												value="#{skProducts.currentProduct.conditioning}" />
										</div>
										<div class="form-group">
											<label for="PrixHT">Prix HT :</label>
											<h:inputText type="number" step="any" class="form-control"
												name="PrixHT" value="#{skProducts.currentProduct.price}" />
										</div>
										<div class="form-group">
											<label for="Durée de préavis">Durée de préavis (en
												jours):</label>
											<h:inputText type="number" step="any" class="form-control"
												name="Durée de préavis"
												value="#{skProducts.currentProduct.warningPeriod}" />
										</div>
										<div class="form-group">
											<label for="Reference">Référence :</label>
											<h:inputText type="text" class="form-control" id="ref"
												name="Reference" disabled="true"
												value="#{skProducts.currentProduct.productId}" />
										</div>
									</td>
									<td>
										<div class="form-group">
											<label for="Image">Image :</label>
											<p:fileUpload value="#{skProduct.image}"
												fileUploadListener="#{skProduct.handleFileUpload}"
												mode="advanced" auto="true"
												allowTypes="/(\.|\/)(jpe?g|png)$/" />
											<i>PNG ou JPEG de taille 100x100px maximum.</i>

										</div>
									</td>
								</tr>
								<tr>
									<td>
										<div class="form-group">
											<label for="Quantite">Seuil minimal de quantité:</label>
											<h:inputText type="number" class="form-control"
												name="Quantite"
												value="#{skProducts.currentProduct.minQuantity}" />
										</div>
									</td>
									<td>
										<div class="checkbox">
											<p:selectBooleanButton id="box"
												value="#{skProducts.currentProduct.visibility}"
												onLabel="Disponible" offLabel="Indisponible"
												onIcon="ui-icon-check" offIcon="ui-icon-close"
												style="width:140px">
											</p:selectBooleanButton>
										</div>
									</td>
								</tr>
							</table>
							<p:commandButton value="Enregistrer"
								action="#{skProducts.updateCurrentProduct()}" update="@all"
								onclick="PF('dlg1').hide();">
							</p:commandButton>
						</p:outputPanel>
					</p:dialog>
				</h:form>
			</f:view>
		</ui:define>
	</ui:composition>
</h:body>
</html>

<!-- <p:graphicImage id="prodImg" value="#{skProducts.byteToImage(image)}"  -->
<!-- 												cache="false" /> -->